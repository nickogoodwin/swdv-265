{"version":3,"names":["AnimatedScrollView","Animated","createAnimatedComponent","ScrollView","sleepToNextFrame","Promise","resolve","requestAnimationFrame","getViewDims","pdfSize","viewSize","viewWidth","width","height","Math","min","viewHeight","useSyncAnimatedXY","varXY","useRef","animated","ValueXY","x","y","static","current","useEffect","handle","addListener","value","removeListener","useZoomGesture","maxScale","hScrollRef","vScrollRef","onZoomIn","onZoomReset","minScale","overshoot","hardMinScale","hardMaxScale","isZoomed","setIsZoomed","useState","gestureRef","containerScale","Value","pinchScale","contentOffset","bufferSize","max","setValue","focalPoint","scale","divide","multiply","interpolate","inputRange","outputRange","extrapolate","gestureHandler","useMemo","Gesture","Pinch","withRef","onStart","e","focalX","focalY","onUpdate","onEnd","targetScale","timing","duration","toValue","useNativeDriver","start","prevScale","prevBufferX","prevIsZoomed","Platform","OS","scrollTo","targetX","targetY","zoomStyle","pdfViewWidth","centerRatioX","add","subtract","translateX","pdfViewHeight","centerRatioY","translateY","transform","ZoomPdfView","props","maximumZoom","onLoadComplete","refreshControl","renderComponent","pdfViewProps","setPdfSize","setViewSize","RenderComponent","PdfView","localOnLoadComplete","useCallback","next","prev","onViewLayout","nativeEvent","layout","Styles","container","event","select","android","row","StyleSheet","create","flex","flexDirection"],"sources":["ZoomPdfView.tsx"],"sourcesContent":["import React, {\n  useState,\n  useRef,\n  useCallback,\n  useEffect,\n  useMemo,\n} from 'react';\nimport {\n  Animated,\n  LayoutChangeEvent,\n  Platform,\n  ScrollViewProps,\n  StyleSheet,\n  View,\n} from 'react-native';\nimport {\n  Gesture,\n  GestureDetector,\n  GestureType,\n  ScrollView,\n} from 'react-native-gesture-handler';\n\nimport type { PageDim } from './PdfUtil';\nimport { LoadCompleteEvent, PdfView, PdfViewProps } from './PdfView';\n\nconst AnimatedScrollView = Animated.createAnimatedComponent(ScrollView);\n\ntype AnimatedStyle = React.ComponentProps<typeof Animated.View>['style'];\ntype ScrollViewRef = React.RefObject<typeof ScrollView>;\n\nexport type PdfComponent = (props: PdfViewProps) => JSX.Element;\n\nexport type ZoomPdfViewProps = PdfViewProps & {\n  /**\n   * Callback when view starts to zoom.\n   */\n  onZoomIn?: () => void;\n\n  /**\n   * Callback when view returns to non-zoomed state.\n   */\n  onZoomReset?: () => void;\n\n  /**\n   * Maximum allowed zoom. Default 2.\n   */\n  maximumZoom?: number;\n\n  /**\n   * A RefreshControl component, used to provide pull-to-refresh\n   * functionality for the internal ScrollView.\n   */\n  refreshControl?: ScrollViewProps['refreshControl'];\n\n  /**\n   * Alternate component to render pdf page. Default is PdfView.\n   */\n  renderComponent?: PdfComponent;\n};\n\n/**\n * Get a `Promise` that will resolve when the next frame can be rendered.\n */\nfunction sleepToNextFrame(): Promise<void> {\n  return new Promise((resolve) => requestAnimationFrame(() => resolve()));\n}\n\n/**\n * Compute base dimensions at which the pdf should be displayed.\n */\nfunction getViewDims(pdfSize: PageDim, viewSize: PageDim) {\n  let viewWidth = viewSize.width;\n  if (\n    pdfSize.width > 0 &&\n    pdfSize.height > pdfSize.width &&\n    viewSize.height > viewWidth\n  ) {\n    // Portrait page on portrait device, shrink to fit.\n    viewWidth = Math.min(\n      viewWidth,\n      (pdfSize.width * viewSize.height) / pdfSize.height\n    );\n  }\n\n  let viewHeight = viewSize.height;\n  if (pdfSize.width > 0) {\n    viewHeight = (pdfSize.height * viewWidth) / pdfSize.width;\n  }\n\n  return { viewWidth, viewHeight };\n}\n\n/**\n * Bind an animated value for sync reads.\n */\nfunction useSyncAnimatedXY() {\n  const varXY = useRef({\n    animated: new Animated.ValueXY({ x: 0, y: 0 }),\n    static: { x: 0, y: 0 },\n  }).current;\n  // Enable sync read of animated variable.\n  useEffect(() => {\n    const { animated } = varXY;\n    const handle = animated.addListener((value) => {\n      varXY.static = value;\n    });\n    return () => {\n      animated.removeListener(handle);\n    };\n  }, [varXY]);\n  return varXY;\n}\n\nfunction useZoomGesture(\n  pdfSize: PageDim,\n  viewSize: PageDim,\n  maxScale: number,\n  hScrollRef: ScrollViewRef,\n  vScrollRef: ScrollViewRef,\n  onZoomIn: (() => void) | undefined,\n  onZoomReset: (() => void) | undefined\n) {\n  // Limits.\n  const minScale = 1;\n  const overshoot = 0.1;\n  const hardMinScale = minScale * (1 - overshoot);\n  const hardMaxScale = maxScale * (1 + overshoot);\n\n  const [isZoomed, setIsZoomed] = useState(false);\n\n  const gestureRef = useRef<GestureType>();\n\n  // Resolution to render.\n  const containerScale = useRef({\n    animated: new Animated.Value(1),\n    static: 1,\n  }).current;\n  const pinchScale = useRef(new Animated.Value(1)).current;\n\n  // Current scroll position.\n  const contentOffset = useSyncAnimatedXY();\n\n  // Centering buffers.\n  const bufferSize = useRef(new Animated.ValueXY({ x: 0, y: 0 })).current;\n  useEffect(() => {\n    const { viewWidth, viewHeight } = getViewDims(pdfSize, viewSize);\n    const width = Math.max(\n      (viewSize.width - containerScale.static * viewWidth) / 2,\n      0\n    );\n    const height = Math.max(\n      viewSize.height - containerScale.static * viewHeight,\n      0\n    );\n\n    bufferSize.setValue({ x: width, y: height });\n  }, [bufferSize, containerScale, pdfSize, viewSize]);\n\n  // Origin point of pinch gesture.\n  const focalPoint = useSyncAnimatedXY();\n  useEffect(() => {\n    focalPoint.animated.setValue({\n      x: viewSize.width / 2,\n      y: viewSize.height / 2,\n    });\n  }, [focalPoint, viewSize]);\n\n  // Pixel interpolation scale. Input driver `pinchScale` is shaped to allow\n  // some bounce past min/max thresholds.\n  // TODO: Is it possible to use easing instead of clamp? Or maybe more\n  // points on in/out range?\n  const scale = useRef(\n    Animated.divide(\n      Animated.multiply(pinchScale, containerScale.animated).interpolate({\n        inputRange: [minScale * 0.5, minScale, maxScale, maxScale * 1.5],\n        outputRange: [hardMinScale, minScale, maxScale, hardMaxScale],\n        extrapolate: 'clamp',\n      }),\n      containerScale.animated\n    )\n  ).current;\n\n  const gestureHandler = useMemo(() => {\n    return Gesture.Pinch()\n      .withRef(gestureRef)\n      .onStart((e) =>\n        focalPoint.animated.setValue({ x: e.focalX, y: e.focalY })\n      )\n      .onUpdate((e) => pinchScale.setValue(e.scale))\n      .onEnd((e) => {\n        // Spring back to scale bounds, if gesture overshot.\n        const targetScale = Math.max(\n          minScale,\n          Math.min(maxScale, e.scale * containerScale.static)\n        );\n\n        Animated.timing(pinchScale, {\n          duration: 200,\n          toValue: targetScale / containerScale.static,\n          useNativeDriver: false,\n        }).start(async () => {\n          const { viewWidth, viewHeight } = getViewDims(pdfSize, viewSize);\n          const prevScale = containerScale.static;\n          const prevBufferX = Math.max(\n            (viewSize.width - prevScale * viewWidth) / 2,\n            0\n          );\n\n          // Apply pinch scaling (pixel interpolation) to container (actual\n          // render quality).\n          containerScale.animated.setValue(targetScale);\n          containerScale.static = targetScale;\n          pinchScale.setValue(1);\n          bufferSize.setValue({\n            x: Math.max((viewSize.width - targetScale * viewWidth) / 2, 0),\n            y: Math.max(viewSize.height - targetScale * viewHeight, 0),\n          });\n\n          // Send zoom events.\n          setIsZoomed((prevIsZoomed) => {\n            if (prevIsZoomed && targetScale <= 1) {\n              if (Platform.OS === 'android') {\n                // Zoom complete, reset horizontal scroll. Needed for Android.\n                hScrollRef.current?.scrollTo({ x: 0, y: 0, animated: true });\n              }\n              if (onZoomReset != null) {\n                onZoomReset();\n              }\n            } else if (!prevIsZoomed && targetScale > 1) {\n              if (onZoomIn != null) {\n                onZoomIn();\n              }\n            }\n            return targetScale > 1;\n          });\n\n          if (targetScale > 1) {\n            // Adjust scroll views to apply scaling in correct location.\n            const targetX =\n              (targetScale / prevScale) *\n                (contentOffset.static.x - prevBufferX + focalPoint.static.x) -\n              focalPoint.static.x;\n            const targetY =\n              (targetScale / prevScale) *\n                (contentOffset.static.y + focalPoint.static.y) -\n              focalPoint.static.y;\n\n            await sleepToNextFrame();\n            hScrollRef.current?.scrollTo({\n              x: targetX,\n              animated: false,\n            });\n            vScrollRef.current?.scrollTo({ y: targetY, animated: false });\n          }\n        });\n      });\n  }, [\n    bufferSize,\n    containerScale,\n    contentOffset,\n    focalPoint,\n    hScrollRef,\n    gestureRef,\n    maxScale,\n    onZoomIn,\n    onZoomReset,\n    pdfSize,\n    pinchScale,\n    setIsZoomed,\n    vScrollRef,\n    viewSize,\n  ]);\n\n  const zoomStyle: AnimatedStyle = useMemo(() => {\n    const { viewWidth, viewHeight } = getViewDims(pdfSize, viewSize);\n\n    const pdfViewWidth = Animated.multiply(containerScale.animated, viewWidth);\n    const centerRatioX = Animated.divide(\n      Animated.add(\n        Animated.subtract(contentOffset.animated.x, bufferSize.x),\n        focalPoint.animated.x\n      ),\n      pdfViewWidth\n    );\n    const translateX = Animated.multiply(\n      Animated.multiply(pdfViewWidth, Animated.subtract(scale, 1)),\n      Animated.subtract(0.5, centerRatioX)\n    );\n\n    const pdfViewHeight = Animated.multiply(\n      containerScale.animated,\n      viewHeight\n    );\n    const centerRatioY = Animated.divide(\n      Animated.add(contentOffset.animated.y, focalPoint.animated.y),\n      pdfViewHeight\n    );\n    const translateY = Animated.multiply(\n      Animated.multiply(pdfViewHeight, Animated.subtract(scale, 1)),\n      Animated.subtract(0.5, centerRatioY)\n    );\n\n    // Allow height to be manged by native pdf component.\n    return {\n      transform: [{ translateX }, { translateY }, { scale }],\n      width: pdfViewWidth,\n    };\n  }, [\n    bufferSize,\n    contentOffset,\n    containerScale,\n    focalPoint,\n    pdfSize,\n    scale,\n    viewSize,\n  ]);\n\n  return {\n    bufferSize,\n    contentOffset,\n    gestureHandler,\n    gestureRef,\n    isZoomed,\n    zoomStyle,\n  };\n}\n\n/**\n * PdfView with pinch zoom support.\n */\nexport function ZoomPdfView(props: ZoomPdfViewProps) {\n  const {\n    maximumZoom,\n    onLoadComplete,\n    onZoomIn,\n    onZoomReset,\n    refreshControl,\n    renderComponent,\n    ...pdfViewProps\n  } = props;\n\n  const [pdfSize, setPdfSize] = useState({ width: -1, height: -1 });\n  const [viewSize, setViewSize] = useState({ width: 1, height: 1 });\n\n  const hScrollRef = useRef<typeof ScrollView>(null);\n  const vScrollRef = useRef<typeof ScrollView>(null);\n\n  const RenderComponent = renderComponent ?? PdfView;\n\n  const {\n    bufferSize,\n    contentOffset,\n    gestureHandler,\n    gestureRef,\n    isZoomed,\n    zoomStyle,\n  } = useZoomGesture(\n    pdfSize,\n    viewSize,\n    maximumZoom ?? 2,\n    hScrollRef,\n    vScrollRef,\n    onZoomIn,\n    onZoomReset\n  );\n\n  // Combine `onLoadComplete` callback from props with logic required\n  // by `ZoomPdfView`.\n  const localOnLoadComplete = useCallback(\n    (e: LoadCompleteEvent) => {\n      onLoadComplete?.(e);\n      const next = { width: e.width, height: e.height };\n      setPdfSize((prev) =>\n        prev.width === next.width && prev.height === next.height ? prev : next\n      );\n    },\n    [onLoadComplete, setPdfSize]\n  );\n\n  // Determine device orientation and (useable) screen ratio.\n  const onViewLayout = useCallback(\n    ({ nativeEvent }: LayoutChangeEvent) => {\n      const next = {\n        width: nativeEvent.layout.width,\n        height: nativeEvent.layout.height,\n      };\n      setViewSize((prev) =>\n        prev.width === next.width && prev.height === next.height ? prev : next\n      );\n    },\n    [setViewSize]\n  );\n\n  // `waitFor` required on Android, otherwise ScrollView overrides\n  // pinch detection.\n  // Horizontal `scrollEnabled` only when zoomed prevents conflict with\n  // swipe between pages.\n  return (\n    <GestureDetector gesture={gestureHandler}>\n      <View style={Styles.container} onLayout={onViewLayout}>\n        <AnimatedScrollView\n          horizontal={true}\n          onScroll={Animated.event(\n            [\n              {\n                nativeEvent: { contentOffset: { x: contentOffset.animated.x } },\n              },\n            ],\n            { useNativeDriver: false }\n          )}\n          ref={hScrollRef}\n          scrollEnabled={isZoomed}\n          scrollEventThrottle={50}\n          waitFor={Platform.select({ android: gestureRef })}\n        >\n          <AnimatedScrollView\n            onScroll={Animated.event(\n              [\n                {\n                  nativeEvent: {\n                    contentOffset: { y: contentOffset.animated.y },\n                  },\n                },\n              ],\n              { useNativeDriver: false }\n            )}\n            ref={vScrollRef}\n            refreshControl={refreshControl}\n            scrollEventThrottle={50}\n            waitFor={Platform.select({ android: gestureRef })}\n          >\n            <View style={Styles.row}>\n              <Animated.View style={{ width: bufferSize.x }} />\n              <Animated.View style={zoomStyle}>\n                <RenderComponent\n                  {...pdfViewProps}\n                  onLoadComplete={localOnLoadComplete}\n                />\n              </Animated.View>\n              <Animated.View style={{ width: bufferSize.x }} />\n            </View>\n            <Animated.View style={{ height: bufferSize.y }} />\n          </AnimatedScrollView>\n        </AnimatedScrollView>\n      </View>\n    </GestureDetector>\n  );\n}\n\nconst Styles = StyleSheet.create({\n  container: { flex: 1 },\n  row: { flexDirection: 'row' },\n});\n"],"mappings":"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"}