{"version":3,"names":["React","useState","useRef","useCallback","useEffect","useMemo","Animated","Platform","StyleSheet","View","Gesture","GestureDetector","ScrollView","PdfView","AnimatedScrollView","createAnimatedComponent","sleepToNextFrame","Promise","resolve","requestAnimationFrame","getViewDims","pdfSize","viewSize","viewWidth","width","height","Math","min","viewHeight","useSyncAnimatedXY","varXY","animated","ValueXY","x","y","static","current","handle","addListener","value","removeListener","useZoomGesture","maxScale","hScrollRef","vScrollRef","onZoomIn","onZoomReset","minScale","overshoot","hardMinScale","hardMaxScale","isZoomed","setIsZoomed","gestureRef","containerScale","Value","pinchScale","contentOffset","bufferSize","max","setValue","focalPoint","scale","divide","multiply","interpolate","inputRange","outputRange","extrapolate","gestureHandler","Pinch","withRef","onStart","e","focalX","focalY","onUpdate","onEnd","targetScale","timing","duration","toValue","useNativeDriver","start","prevScale","prevBufferX","prevIsZoomed","OS","scrollTo","targetX","targetY","zoomStyle","pdfViewWidth","centerRatioX","add","subtract","translateX","pdfViewHeight","centerRatioY","translateY","transform","ZoomPdfView","props","maximumZoom","onLoadComplete","refreshControl","renderComponent","pdfViewProps","setPdfSize","setViewSize","RenderComponent","localOnLoadComplete","next","prev","onViewLayout","nativeEvent","layout","Styles","container","event","select","android","row","create","flex","flexDirection"],"sources":["ZoomPdfView.tsx"],"sourcesContent":["import React, {\n  useState,\n  useRef,\n  useCallback,\n  useEffect,\n  useMemo,\n} from 'react';\nimport {\n  Animated,\n  LayoutChangeEvent,\n  Platform,\n  ScrollViewProps,\n  StyleSheet,\n  View,\n} from 'react-native';\nimport {\n  Gesture,\n  GestureDetector,\n  GestureType,\n  ScrollView,\n} from 'react-native-gesture-handler';\n\nimport type { PageDim } from './PdfUtil';\nimport { LoadCompleteEvent, PdfView, PdfViewProps } from './PdfView';\n\nconst AnimatedScrollView = Animated.createAnimatedComponent(ScrollView);\n\ntype AnimatedStyle = React.ComponentProps<typeof Animated.View>['style'];\ntype ScrollViewRef = React.RefObject<typeof ScrollView>;\n\nexport type PdfComponent = (props: PdfViewProps) => JSX.Element;\n\nexport type ZoomPdfViewProps = PdfViewProps & {\n  /**\n   * Callback when view starts to zoom.\n   */\n  onZoomIn?: () => void;\n\n  /**\n   * Callback when view returns to non-zoomed state.\n   */\n  onZoomReset?: () => void;\n\n  /**\n   * Maximum allowed zoom. Default 2.\n   */\n  maximumZoom?: number;\n\n  /**\n   * A RefreshControl component, used to provide pull-to-refresh\n   * functionality for the internal ScrollView.\n   */\n  refreshControl?: ScrollViewProps['refreshControl'];\n\n  /**\n   * Alternate component to render pdf page. Default is PdfView.\n   */\n  renderComponent?: PdfComponent;\n};\n\n/**\n * Get a `Promise` that will resolve when the next frame can be rendered.\n */\nfunction sleepToNextFrame(): Promise<void> {\n  return new Promise((resolve) => requestAnimationFrame(() => resolve()));\n}\n\n/**\n * Compute base dimensions at which the pdf should be displayed.\n */\nfunction getViewDims(pdfSize: PageDim, viewSize: PageDim) {\n  let viewWidth = viewSize.width;\n  if (\n    pdfSize.width > 0 &&\n    pdfSize.height > pdfSize.width &&\n    viewSize.height > viewWidth\n  ) {\n    // Portrait page on portrait device, shrink to fit.\n    viewWidth = Math.min(\n      viewWidth,\n      (pdfSize.width * viewSize.height) / pdfSize.height\n    );\n  }\n\n  let viewHeight = viewSize.height;\n  if (pdfSize.width > 0) {\n    viewHeight = (pdfSize.height * viewWidth) / pdfSize.width;\n  }\n\n  return { viewWidth, viewHeight };\n}\n\n/**\n * Bind an animated value for sync reads.\n */\nfunction useSyncAnimatedXY() {\n  const varXY = useRef({\n    animated: new Animated.ValueXY({ x: 0, y: 0 }),\n    static: { x: 0, y: 0 },\n  }).current;\n  // Enable sync read of animated variable.\n  useEffect(() => {\n    const { animated } = varXY;\n    const handle = animated.addListener((value) => {\n      varXY.static = value;\n    });\n    return () => {\n      animated.removeListener(handle);\n    };\n  }, [varXY]);\n  return varXY;\n}\n\nfunction useZoomGesture(\n  pdfSize: PageDim,\n  viewSize: PageDim,\n  maxScale: number,\n  hScrollRef: ScrollViewRef,\n  vScrollRef: ScrollViewRef,\n  onZoomIn: (() => void) | undefined,\n  onZoomReset: (() => void) | undefined\n) {\n  // Limits.\n  const minScale = 1;\n  const overshoot = 0.1;\n  const hardMinScale = minScale * (1 - overshoot);\n  const hardMaxScale = maxScale * (1 + overshoot);\n\n  const [isZoomed, setIsZoomed] = useState(false);\n\n  const gestureRef = useRef<GestureType>();\n\n  // Resolution to render.\n  const containerScale = useRef({\n    animated: new Animated.Value(1),\n    static: 1,\n  }).current;\n  const pinchScale = useRef(new Animated.Value(1)).current;\n\n  // Current scroll position.\n  const contentOffset = useSyncAnimatedXY();\n\n  // Centering buffers.\n  const bufferSize = useRef(new Animated.ValueXY({ x: 0, y: 0 })).current;\n  useEffect(() => {\n    const { viewWidth, viewHeight } = getViewDims(pdfSize, viewSize);\n    const width = Math.max(\n      (viewSize.width - containerScale.static * viewWidth) / 2,\n      0\n    );\n    const height = Math.max(\n      viewSize.height - containerScale.static * viewHeight,\n      0\n    );\n\n    bufferSize.setValue({ x: width, y: height });\n  }, [bufferSize, containerScale, pdfSize, viewSize]);\n\n  // Origin point of pinch gesture.\n  const focalPoint = useSyncAnimatedXY();\n  useEffect(() => {\n    focalPoint.animated.setValue({\n      x: viewSize.width / 2,\n      y: viewSize.height / 2,\n    });\n  }, [focalPoint, viewSize]);\n\n  // Pixel interpolation scale. Input driver `pinchScale` is shaped to allow\n  // some bounce past min/max thresholds.\n  // TODO: Is it possible to use easing instead of clamp? Or maybe more\n  // points on in/out range?\n  const scale = useRef(\n    Animated.divide(\n      Animated.multiply(pinchScale, containerScale.animated).interpolate({\n        inputRange: [minScale * 0.5, minScale, maxScale, maxScale * 1.5],\n        outputRange: [hardMinScale, minScale, maxScale, hardMaxScale],\n        extrapolate: 'clamp',\n      }),\n      containerScale.animated\n    )\n  ).current;\n\n  const gestureHandler = useMemo(() => {\n    return Gesture.Pinch()\n      .withRef(gestureRef)\n      .onStart((e) =>\n        focalPoint.animated.setValue({ x: e.focalX, y: e.focalY })\n      )\n      .onUpdate((e) => pinchScale.setValue(e.scale))\n      .onEnd((e) => {\n        // Spring back to scale bounds, if gesture overshot.\n        const targetScale = Math.max(\n          minScale,\n          Math.min(maxScale, e.scale * containerScale.static)\n        );\n\n        Animated.timing(pinchScale, {\n          duration: 200,\n          toValue: targetScale / containerScale.static,\n          useNativeDriver: false,\n        }).start(async () => {\n          const { viewWidth, viewHeight } = getViewDims(pdfSize, viewSize);\n          const prevScale = containerScale.static;\n          const prevBufferX = Math.max(\n            (viewSize.width - prevScale * viewWidth) / 2,\n            0\n          );\n\n          // Apply pinch scaling (pixel interpolation) to container (actual\n          // render quality).\n          containerScale.animated.setValue(targetScale);\n          containerScale.static = targetScale;\n          pinchScale.setValue(1);\n          bufferSize.setValue({\n            x: Math.max((viewSize.width - targetScale * viewWidth) / 2, 0),\n            y: Math.max(viewSize.height - targetScale * viewHeight, 0),\n          });\n\n          // Send zoom events.\n          setIsZoomed((prevIsZoomed) => {\n            if (prevIsZoomed && targetScale <= 1) {\n              if (Platform.OS === 'android') {\n                // Zoom complete, reset horizontal scroll. Needed for Android.\n                hScrollRef.current?.scrollTo({ x: 0, y: 0, animated: true });\n              }\n              if (onZoomReset != null) {\n                onZoomReset();\n              }\n            } else if (!prevIsZoomed && targetScale > 1) {\n              if (onZoomIn != null) {\n                onZoomIn();\n              }\n            }\n            return targetScale > 1;\n          });\n\n          if (targetScale > 1) {\n            // Adjust scroll views to apply scaling in correct location.\n            const targetX =\n              (targetScale / prevScale) *\n                (contentOffset.static.x - prevBufferX + focalPoint.static.x) -\n              focalPoint.static.x;\n            const targetY =\n              (targetScale / prevScale) *\n                (contentOffset.static.y + focalPoint.static.y) -\n              focalPoint.static.y;\n\n            await sleepToNextFrame();\n            hScrollRef.current?.scrollTo({\n              x: targetX,\n              animated: false,\n            });\n            vScrollRef.current?.scrollTo({ y: targetY, animated: false });\n          }\n        });\n      });\n  }, [\n    bufferSize,\n    containerScale,\n    contentOffset,\n    focalPoint,\n    hScrollRef,\n    gestureRef,\n    maxScale,\n    onZoomIn,\n    onZoomReset,\n    pdfSize,\n    pinchScale,\n    setIsZoomed,\n    vScrollRef,\n    viewSize,\n  ]);\n\n  const zoomStyle: AnimatedStyle = useMemo(() => {\n    const { viewWidth, viewHeight } = getViewDims(pdfSize, viewSize);\n\n    const pdfViewWidth = Animated.multiply(containerScale.animated, viewWidth);\n    const centerRatioX = Animated.divide(\n      Animated.add(\n        Animated.subtract(contentOffset.animated.x, bufferSize.x),\n        focalPoint.animated.x\n      ),\n      pdfViewWidth\n    );\n    const translateX = Animated.multiply(\n      Animated.multiply(pdfViewWidth, Animated.subtract(scale, 1)),\n      Animated.subtract(0.5, centerRatioX)\n    );\n\n    const pdfViewHeight = Animated.multiply(\n      containerScale.animated,\n      viewHeight\n    );\n    const centerRatioY = Animated.divide(\n      Animated.add(contentOffset.animated.y, focalPoint.animated.y),\n      pdfViewHeight\n    );\n    const translateY = Animated.multiply(\n      Animated.multiply(pdfViewHeight, Animated.subtract(scale, 1)),\n      Animated.subtract(0.5, centerRatioY)\n    );\n\n    // Allow height to be manged by native pdf component.\n    return {\n      transform: [{ translateX }, { translateY }, { scale }],\n      width: pdfViewWidth,\n    };\n  }, [\n    bufferSize,\n    contentOffset,\n    containerScale,\n    focalPoint,\n    pdfSize,\n    scale,\n    viewSize,\n  ]);\n\n  return {\n    bufferSize,\n    contentOffset,\n    gestureHandler,\n    gestureRef,\n    isZoomed,\n    zoomStyle,\n  };\n}\n\n/**\n * PdfView with pinch zoom support.\n */\nexport function ZoomPdfView(props: ZoomPdfViewProps) {\n  const {\n    maximumZoom,\n    onLoadComplete,\n    onZoomIn,\n    onZoomReset,\n    refreshControl,\n    renderComponent,\n    ...pdfViewProps\n  } = props;\n\n  const [pdfSize, setPdfSize] = useState({ width: -1, height: -1 });\n  const [viewSize, setViewSize] = useState({ width: 1, height: 1 });\n\n  const hScrollRef = useRef<typeof ScrollView>(null);\n  const vScrollRef = useRef<typeof ScrollView>(null);\n\n  const RenderComponent = renderComponent ?? PdfView;\n\n  const {\n    bufferSize,\n    contentOffset,\n    gestureHandler,\n    gestureRef,\n    isZoomed,\n    zoomStyle,\n  } = useZoomGesture(\n    pdfSize,\n    viewSize,\n    maximumZoom ?? 2,\n    hScrollRef,\n    vScrollRef,\n    onZoomIn,\n    onZoomReset\n  );\n\n  // Combine `onLoadComplete` callback from props with logic required\n  // by `ZoomPdfView`.\n  const localOnLoadComplete = useCallback(\n    (e: LoadCompleteEvent) => {\n      onLoadComplete?.(e);\n      const next = { width: e.width, height: e.height };\n      setPdfSize((prev) =>\n        prev.width === next.width && prev.height === next.height ? prev : next\n      );\n    },\n    [onLoadComplete, setPdfSize]\n  );\n\n  // Determine device orientation and (useable) screen ratio.\n  const onViewLayout = useCallback(\n    ({ nativeEvent }: LayoutChangeEvent) => {\n      const next = {\n        width: nativeEvent.layout.width,\n        height: nativeEvent.layout.height,\n      };\n      setViewSize((prev) =>\n        prev.width === next.width && prev.height === next.height ? prev : next\n      );\n    },\n    [setViewSize]\n  );\n\n  // `waitFor` required on Android, otherwise ScrollView overrides\n  // pinch detection.\n  // Horizontal `scrollEnabled` only when zoomed prevents conflict with\n  // swipe between pages.\n  return (\n    <GestureDetector gesture={gestureHandler}>\n      <View style={Styles.container} onLayout={onViewLayout}>\n        <AnimatedScrollView\n          horizontal={true}\n          onScroll={Animated.event(\n            [\n              {\n                nativeEvent: { contentOffset: { x: contentOffset.animated.x } },\n              },\n            ],\n            { useNativeDriver: false }\n          )}\n          ref={hScrollRef}\n          scrollEnabled={isZoomed}\n          scrollEventThrottle={50}\n          waitFor={Platform.select({ android: gestureRef })}\n        >\n          <AnimatedScrollView\n            onScroll={Animated.event(\n              [\n                {\n                  nativeEvent: {\n                    contentOffset: { y: contentOffset.animated.y },\n                  },\n                },\n              ],\n              { useNativeDriver: false }\n            )}\n            ref={vScrollRef}\n            refreshControl={refreshControl}\n            scrollEventThrottle={50}\n            waitFor={Platform.select({ android: gestureRef })}\n          >\n            <View style={Styles.row}>\n              <Animated.View style={{ width: bufferSize.x }} />\n              <Animated.View style={zoomStyle}>\n                <RenderComponent\n                  {...pdfViewProps}\n                  onLoadComplete={localOnLoadComplete}\n                />\n              </Animated.View>\n              <Animated.View style={{ width: bufferSize.x }} />\n            </View>\n            <Animated.View style={{ height: bufferSize.y }} />\n          </AnimatedScrollView>\n        </AnimatedScrollView>\n      </View>\n    </GestureDetector>\n  );\n}\n\nconst Styles = StyleSheet.create({\n  container: { flex: 1 },\n  row: { flexDirection: 'row' },\n});\n"],"mappings":"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"}